define("Class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,n=function(){};return n.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o},n}),define("AsyncRequester",["Class"],function(e){var t=e.extend({init:function(e){this.session=e},makeRequest:function(e,t,n){var r=this,i=e.fail(function(e){return r.invalidTokenHandler(e)}).fail(function(e){return r.adaptError(e,n)});if(!t)return this.options.error&&i.then(null,this.options.error),i;var s=this.getCallbacks(t);i.then(s.success,s.error).end()},invalidTokenHandler:function(e){if(e.status==0||e.status==401)if(e.status==0)e.status=401,e.error={},e.error.errors={},e.error.errors.error={code:"Unauthorized",description:"Invalid token"};else{var t;e.error.errors.error[0]?t=e.error.errors.error[0]:t=e.error.errors.error,e.error={},e.error.errors={},e.error.errors.error={code:t.code,description:t.description}}throw e},failRequest:function(e,t){if(!t){var n=Q.defer();return n.reject(e),n.promise}cb.error(e)},load:function(e,t,n){return e&&e.uri?this.makeRequest(this.session.retrieve(e.uri,t),n):this.failRequest("The resource does not provide a URI",n)},adaptError:function(e,t){throw e.error&&e.error.errors&&e.error.errors.error&&(e.error=e.error.errors.error),{status:e.status,details:e,handled:t}},getCallbacks:function(e){var t=this,n={};return e||(e={}),n.error=function(n){e.error&&typeof e.error=="function"?(e.error(n),e.callDefaultErrorHandler&&t.options.error&&typeof t.options.error=="function"&&t.options.error(n)):t.options.error&&typeof t.options.error=="function"&&t.options.error(n)},n.success=function(n){e.success&&typeof e.success=="function"?e.success(n):e&&typeof e=="function"?e(n):t.options.success&&typeof t.options.success=="function"&&t.options.success(n)},n}});return t}),define("service/BaseService",["AsyncRequester"],function(e){return e.extend({init:function(e){if(!e)throw"Client must be instantiated";this._super(e.session),this.client=e,this.options=e.options},get:function(e,t,n){var r=this.uri+"/"+e;return this.makeRequest(this.session.retrieve(r,t),n)},list:function(e,t){return this.makeRequest(this.session.retrieve(this.uri,e),t)},parseResponse:function(e){return e},replaceTemplate:function(e,t){for(var n in t)e=e.replace("{"+n+"}",t[n]);return e}})}),define("Util",[],function(){var e={};return e.namespace=function(e){var t=e.split("."),n=window,r="";for(var i=0,s=t.length;i<s;i++)r=t[i],n[r]=n[r]||{},n=n[r];return n},e.is_array=function(e){return typeof e=="object"&&e instanceof Array},e.is_string=function(e){return typeof e=="string"},e.getAttribute=function(e,t){var n=t.split("."),r=e,i="";for(var s=0,o=n.length;s<o;s++)i=n[s],r[i]=r[i]||{},r=r[i];return r},e.setAttribute=function(e,t,n){var r=t.split("."),i=e,s="";for(var o=0,u=r.length;o<u-1;o++)s=r[o],i[s]=i[s]||{},i=i[s];i[r[u-1]]=n},e.merge=function(e,t){for(var n in t)e[n]=t[n];return e},e.isAbsoluteUri=function(e){return e.lastIndexOf("http",0)===0},e.Error=function(e){this.message=e},e.getQueryStringParam=function(e,t){var n=(new RegExp("[\\?&]"+t+"=([^&#]*)")).exec(e);return n?n[1]||0:""},e.getCurrentPath=function(){var e=window.location.href.replace(window.location.hash,"");return e.substring(0,e.lastIndexOf("/"))},e}),define("Config",["Util"],function(e){var t={};return t.authMode={POPUP:"POPUP",IFRAME:"IFRAME",WINDOW:"WINDOW",MANUAL:"MANUAL"},t.config={AUTH_FRAME_ID:"drApiAuthFrame",DEFAULT_REDIRECT_URI:e.getCurrentPath()+"/drapi-auth.html",EDIT_ACCOUNT_FRAME_ID:"drEditAccountFrame",EDIT_ACCOUNT_REDIRECT_URI:e.getCurrentPath()+"/drapi-editaccount.html"},t.connection={},t.connection.URI={BASE_URL:null,DEV_BASE_URL:"https://api.digitalriver.com/",PRD_BASE_URL:"https://api.digitalriver.com/",VERSION:"v1",ANONYMOUS_LOGIN:"oauth20/token",LOGIN:"oauth20/authorize"},t.connection.TYPE={XML:"1",JSON:"2",TEXT:"3",UNSIGNED_BYTES:"4"},t.service={},t.service.URI={CATEGORIES:"shoppers/me/categories",PRODUCTS:"shoppers/me/products",PRODUCTS_BY_CATEGORY:"shoppers/me/categories/{categoryId}/products",OFFERS:"shoppers/me/point-of-promotions/{popName}/offers",PRODUCT_OFFERS:"shoppers/me/point-of-promotions/{popName}/offers/{offerId}/product-offers",OFFERS_FOR_PRODUCT:"shoppers/me/products/{productId}/point-of-promotions/{popName}/offers",PRODUCTS_SEARCH:"/shoppers/me/product-search",CART:"shoppers/me/carts/active",CART_LINE_ITEMS:"shoppers/me/carts/active/line-items",CART_OFFERS:"shoppers/me/carts/active/point-of-promotions/{popName}/offers",CART_APPLY_SHOPPER:"shoppers/me/carts/active/apply-shopper",CART_SHIPPING_OPTIONS:"shoppers/me/carts/active/shipping-options",CART_APPLY_SHIPPING_OPTION:"shoppers/me/carts/active/apply-shipping-option",CART_SUBMIT:"shoppers/me/carts/active/submit-cart",SHOPPER:"shoppers/me",SHOPPER_PAYMENT_OPTION:"shoppers/me/payment-options",SHOPPER_ACCOUNT:"shoppers/me/account",ORDERS:"shoppers/me/orders",ORDER_SHIPPING_ADDRESS:"shoppers/me/orders/{orderId}/shipping-address",ORDER_BILLING_ADDRESS:"shoppers/me/orders/{orderId}/billing-address",ADDRESS:"shoppers/me/addresses"},t}),define("view/EditAccountIFrameView",["Config"],function(e){var t=function(t,n,r){this.uri=t+"?redirect_uri="+encodeURIComponent(n),this.id=e.config.EDIT_ACCOUNT_FRAME_ID,this.parentElementId=r.elementId};return t.prototype.open=function(e,t){var n=document.getElementById(this.id);n||(n=this.create());var r=this.uri+"&token="+e;n.onload=function(){this.src==r&&t&&t()},n.src=r},t.prototype.close=function(){console.log("Closing Edit Account IFrame");var e=document.getElementById(this.id);e&&e.parentNode.removeChild(e)},t.prototype.create=function(){var e=document.createElement("iframe");e.id=this.id,e.width="100%",e.height="100%",e.style.margin="auto",e.style.border="none",e.scrolling="auto";var t=this.parentElementId!=""?document.getElementById(this.parentElementId):document.body;return t.appendChild(e),e},t}),define("service/ShopperService",["service/BaseService","Config","q","view/EditAccountIFrameView"],function(e,t,n,r){var i=e.extend({uri:t.service.URI.SHOPPER,get:function(e,t){return this.makeRequest(this.session.retrieve(this.uri,e),t)},getAddresses:function(e,n){var r=t.service.URI.ADDRESS;return this.makeRequest(this.session.retrieve(r,e),n)},getPaymentOptions:function(e,n){var r=t.service.URI.SHOPPER_PAYMENT_OPTION;return this.makeRequest(this.session.retrieve(r,e),n)},editAccount:function(e,s,o){var u=t.connection.URI.BASE_URL+t.connection.URI.VERSION+"/"+t.service.URI.SHOPPER_ACCOUNT,a=n.defer(),f=t.config.EDIT_ACCOUNT_REDIRECT_URI;return this.view=new r(u,f,e),i.currentRequest={defer:a,view:this.view},this.view.open(this.session.token,o),this.makeRequest(a.promise,s)}});return i.editCallback=function(){var e=i.currentRequest;e&&(e.view.close(),e.view=null,i.currentRequest=null,window.focus(),e.defer.resolve())},i}),define("view/AuthViewUtil",[],function(){return{buildUriFromOptions:function(e,t,n){var r=e+"?redirect_uri="+encodeURIComponent(t)+"&response_type=token"+"&client_id="+n.client_id;return r},getUriWithToken:function(e,t){var n=e+"&dr_limited_token="+t;return n}}}),define("view/AuthWindowView",["view/AuthViewUtil","Config"],function(e,t){var n=function(n,r,i){this.uri=e.buildUriFromOptions(n,r,i),this.id=t.config.AUTH_FRAME_ID};return n.prototype.open=function(t,n){this.popup&&this.close();var r=e.getUriWithToken(this.uri,t);this.popup=window.open(r,this.id),this.popup.focus()},n.prototype.close=function(){console.log("Closing Auth popup"),this.popup&&(this.popup.close(),this.popup=null)},n}),define("view/AuthIFrameView",["view/AuthViewUtil","Config"],function(e,t){var n=function(n,r,i){this.uri=e.buildUriFromOptions(n,r,i),this.id=t.config.AUTH_FRAME_ID,this.parentElementId=i.elementId};return n.prototype.open=function(t,n){var r=document.getElementById(this.id);r||(r=this.create());var i=e.getUriWithToken(this.uri,t);r.onload=function(){this.src==i&&n&&n()},r.src=i},n.prototype.close=function(){console.log("Closing Auth IFrame");var e=document.getElementById(this.id);e&&e.parentNode.removeChild(e)},n.prototype.create=function(){var e=document.createElement("iframe");e.id=this.id,e.width="100%",e.height="100%",e.style.margin="auto",e.style.border="none",e.scrolling="auto";var t=this.parentElementId!=""?document.getElementById(this.parentElementId):document.body;return t.appendChild(e),e},n.prototype.AddOnLoadedHandler=function(){authFrame},n}),define("view/AuthManualView",["view/AuthViewUtil","Config"],function(e,t){var n=function(t,n,r){this.uriWithoutToken=e.buildUriFromOptions(t,n,r)};return n.prototype.open=function(t,n){var r=e.getUriWithToken(this.uriWithoutToken,t);this.uri=r,n&&n(this)},n.prototype.close=function(){},n.prototype.setResults=function(e,t){dr.api.callbacks.auth(e,t,null,null)},n.prototype.setError=function(e,t){dr.api.callbacks.auth(null,null,e,t)},n}),define("auth/AuthManager",["q","view/AuthWindowView","view/AuthIFrameView","view/AuthManualView"],function(e,t,n,r){var i=function(e,i){this.redirectUri=i.authRedirectUrl,this.uri=e,this.views={IFRAME:n,WINDOW:t,MANUAL:r},this.view=this.createView(i.strategy,i)};return i.prototype.createView=function(e,t){return new this.views[e](this.uri,this.redirectUri,t)},i.prototype.login=function(t,n){var r=e.defer();return i.currentRequest={defer:r,view:this.view},this.view.open(t,n),r.promise},i.authCallback=function(e,t,n,r,s){var o=i.currentRequest;if(o){o.view.close(),o.view=null,i.currentRequest=null,window.focus();if(!r){var u;e===""&&n!=""?u={code:n}:u={token:e,expires_in:t},o.defer.resolve(u)}else{var a={error:r,error_description:s};o.defer.reject(a)}}},i.getError=function(e){switch(e){case"invalid_request":return{error:e,error_description:"Invalid Request. Please check the parameters."}}},i}),define("Ajax",["q"],function(e){var t={};return t.doAjax=function(t,n,r,i,s){var o=e.defer(),u=this.createRequest();return u.onreadystatechange=function(){if(u.readyState==4){var e=u.responseText;e!=""&&(e=JSON.parse(e));if(u.status!=""&&u.status<300)o.resolve(e);else{var t=e.Exception?e.Exception.Error:e;o.reject({status:u.status,error:t})}}},this.sendRequest(t,n,r,i,u,s),o.promise},t.createRequest=function(){try{req=new XMLHttpRequest}catch(e){try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){req=!1}}}return req},t.sendRequest=function(e,t,n,r,i,s){n=n||{},n.drapits=(new Date).getTime();var o=this.utf8Encode(this.getQueryString(n)),u=e;o!=""&&(u+=(e.indexOf("?")>0?"&":"?")+o),i.open(t,u,!0),i=this.setHeader(r,i);if(s){var a=r["Content-Type"];a=="application/x-www-form-urlencoded"&&(s=this.utf8Encode(this.getQueryString(s))),i.send(s)}else i.send()},t.getQueryString=function(e){var t="";for(var n in e)n&&(t+=n+"="+e[n]+"&");return t.substring(0,t.length-1)},t.setHeader=function(e,t){t.setRequestHeader("Accept","application/json");for(var n in e)t.setRequestHeader(n,e[n]);return t},t.utf8Encode=function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t},t.isEmpty=function(e){for(var t in e)return!1;return!0},t}),define("connection/Connection",["Config","Ajax","Util"],function(e,t,n){var r=function(){console.log("Using real Connection"),this.baseUrl=e.connection.URI.BASE_URL+e.connection.URI.VERSION+"/"};return r.prototype.create=function(e,t,n,r){return this.request(e,"POST",t,n,r)},r.prototype.retrieve=function(e,t,n,r){return this.request(e,"GET",t,n,r)},r.prototype.update=function(e,t,n){return this.request(e,"PUT",t,n)},r.prototype.remove=function(e,t,n){return this.request(e,"DELETE",t,n)},r.prototype.submitForm=function(e,t,n){return n=n||{},n["Content-Type"]="application/x-www-form-urlencoded",this.request(e,"POST",{},n,t)},r.prototype.request=function(e,r,i,s,o){return n.isAbsoluteUri(e)||(e=this.baseUrl+e),t.doAjax(e,r,i,s,o)},r}),define("connection/Session",["Config","connection/Connection","auth/AuthManager","q"],function(e,t,n,r){var i=function(r,i){this.apikey=r,this.connection=new t,this.authManager=new n(e.connection.URI.BASE_URL+e.connection.URI.LOGIN,i),this.reset()};return i.prototype.createErrorPromise=function(e){console.log("Operation not allowed: "+e);var t=this.createServerErrorResponse(),n=r.defer();return n.reject(t),n.promise},i.prototype.createDisconnectedError=function(){return this.createErrorPromise("You must be connected to the server in order to use the API")},i.prototype.createServerErrorResponse=function(){var e={},t={};return t.code="server_error",t.description="Service Temporaly Unavailable. Please try again later or contact the System Administrator.",e.status=500,e.error={},e.error.errors={},e.error.errors.error=t,e},i.prototype.create=function(e,t,n){if(!this.connected)return this.createDisconnectedError();var r={};r.Authorization="bearer "+this.token;var i=n;n&&(r["Content-Type"]="application/json",i=JSON.stringify(n));var s=this.connection.create(e,t,r,i).then(function(e){for(var t in e)if(t)return e[t]});return s},i.prototype.remove=function(e,t){if(!this.connected)return this.createDisconnectedError();var n={};n.Authorization="bearer "+this.token,t||(t={}),t.client_id=this.apikey;var r=this.connection.remove(e,t,n).then(function(e){for(var t in e)if(t)return e[t]});return r},i.prototype.retrieve=function(e,t){if(!this.connected)return this.createDisconnectedError();var n={};n.Authorization="bearer "+this.token,t||(t={}),t.client_id=this.apikey;var r=this,i=this.connection.retrieve(e,t,n).then(function(e){for(var t in e)if(t)return e[t]});return i},i.prototype.errorHandle=function(e){},i.prototype.anonymousLogin=function(){var t=e.connection.URI.BASE_URL+e.connection.URI.ANONYMOUS_LOGIN,n=this,r=new Date;if(this.refreshToken)return this.getRefreshToken();var i={client_id:this.apikey,ts:r.getTime(),grant_type:"password",username:"anonymous",password:"anonymous"};return this.connection.submitForm(t,i,{}).then(function(e){return n.connected=!0,n.token=e.access_token,n.refreshToken=e.refresh_token,console.debug("[DR Api Library] Anonymous token obtained: "+n.token),n.tokenStartTime=(new Date).getTime()/1e3,n.tokenExpirationTime=(new Date).getTime()/1e3+parseInt(e.expires_in),e}).fail(function(e){console.debug("[DR Api Library] Token failure. Application could not obtain an anonymous token."),n.reset();var t=n.createServerErrorResponse();throw t})},i.prototype.getRefreshToken=function(){var t=e.connection.URI.BASE_URL+e.connection.URI.ANONYMOUS_LOGIN,n=this,r=new Date,i={client_id:this.apikey,ts:r.getTime(),grant_type:"refresh_token",refresh_token:this.refreshToken};return this.connection.submitForm(t,i,{}).then(function(e){return n.connected=!0,n.token=e.access_token,n.refreshToken=e.refresh_token,console.debug("[DR Api Library] Anonymous token obtained using Refresh Token: "+n.token),n.tokenStartTime=(new Date).getTime()/1e3,n.tokenExpirationTime=(new Date).getTime()/1e3+parseInt(e.expires_in),e}).fail(function(e){console.debug("[DR Api Library] Token failure. Application could not obtain an anonymous token using a refresh token."),n.refreshToken=null;var t={},r={};throw r.code="refresh_token_invalid",r.description="The Refresh Token is invalid",t.status=401,t.error={},t.error.errors={},t.error.errors.error=r,t})},i.prototype.setSessionInfo=function(e){this.connected=e.connected,this.authenticated=e.authenticated,this.token=e.token,this.refreshToken=e.refreshToken,this.tokenExpirationTime=e.tokenExpirationTime},i.prototype.forceRefreshToken=function(){return this.getRefreshToken()},i.prototype.forceResetSession=function(){return this.reset(),this.anonymousLogin()},i.prototype.reset=function(){this.token=null,this.refreshToken=null,this.connected=!1,this.authenticated=!1,this.tokenStartTime=null,this.tokenExpirationTime=null},i.prototype.authenticate=function(e){var t=this;if(!this.connected)return this.createDisconnectedError();var n=r.defer(),i=this.authManager.login(this.token,e);return i.then(function(e){if(e.token&&e.token!="")t.token=e.token,t.authenticated=!0,t.refreshToken=null,t.tokenStartTime=(new Date).getTime()/1e3,t.tokenExpirationTime=(new Date).getTime()/1e3+parseInt(e.expires_in),console.debug("[DR Api Library] Authenticated token obtained: "+t.token);else if(e.code)return t.getAutorizationCodeToken(e.code,n);n.resolve(e.token)}),n.promise},i.prototype.getAutorizationCodeToken=function(t,n){var r=e.connection.URI.BASE_URL+e.connection.URI.ANONYMOUS_LOGIN,i=e.config.DEFAULT_REDIRECT_URI,s=this,o=new Date,u={client_id:this.apikey,ts:o.getTime(),grant_type:"authorization_code",code:t,redirect_uri:i,dr_limited_token:this.token};return this.connection.submitForm(r,u,{}).then(function(e){e.access_token!=""&&(s.token=e.access_token,s.authenticated=!0,s.refreshToken=null,s.tokenStartTime=(new Date).getTime()/1e3,s.tokenExpirationTime=(new Date).getTime()/1e3+parseInt(e.expires_in),console.debug("[DR Api Library] Authenticated token obtained using Autorization Code: "+s.token)),n.resolve(e.access_token)}).fail(function(e){console.debug("[DR Api Library] Token failure. Application could not obtain a token using an authorization code."),s.refreshToken=null;var t={},r={};r.code="authotization_code_invalid",r.description="The Authorization Code is Invalid",t.status=401,t.error={},t.error.errors={},t.error.errors.error=r,n.reject(t)})},i.prototype.disconnect=function(){this.token=null,this.authenticated=!1,this.connected=!1;var e=r.defer();return e.resolve(),e.promise},i.prototype.logout=function(){if(!this.connected)return this.createDisconnectedError();if(this.authenticated)return this.reset(),this.anonymousLogin();var e=r.defer();return e.resolve(),e.promise},i.prototype.handleExpansion=function(e,t){var n=this;return e.then(function(e){return n.expand(e,t)})},i.prototype.expand=function(e,t){var n=this,i=getAttribute(e,t),s=[],o=is_array(i);if(o)for(var u=0;u<i.length;u++){var a=i[u];s.push(n.retrieve(a.uri,{}))}else s.push(n.retrieve(i.uri,{}));return r.all(s).then(function(n){if(o){setAttribute(e,t,[]);var r=getAttribute(e,t);for(var i=0;i<n.length;i++)r.push(n[i])}else setAttribute(e,t,n[0]);return e})},i}),define("service/CartService",["service/BaseService","Config"],function(e,t){return e.extend({uri:t.service.URI.CART,addLineItem:function(e,t,n,r){var i;return t?i=t:i=e.addProductToCart.uri,this.makeRequest(this.session.create(i,n),r)},addMultipleLineItems:function(e,n,r){var i=t.service.URI.CART_LINE_ITEMS;return this.makeRequest(this.session.create(i,e,n),r)},get:function(e,t){return this.makeRequest(this.session.retrieve(this.uri,e),t)},updateCart:function(e,t){return this.makeRequest(this.session.create(this.uri,e),t)},removeLineItem:function(e,t,n){return this.makeRequest(this.session.remove(e.uri,t),n)},editLineItemQuantity:function(e,t,n){return this.makeRequest(this.session.create(e.uri,t),n)},getShippingOptions:function(e,n){var r=t.service.URI.CART_SHIPPING_OPTIONS;return this.makeRequest(this.session.retrieve(r,e),n)},getOffers:function(e,n,r,i){var s=this.replaceTemplate(t.service.URI.CART_OFFERS,{popName:e});return this.makeRequest(this.session.retrieve(s,n),r,i)},applyShippingOption:function(e,n){var r=t.service.URI.CART_APPLY_SHIPPING_OPTION;return this.makeRequest(this.session.create(r,e),n)},applyShopper:function(e,n){var r=t.service.URI.CART_APPLY_SHOPPER;return this.makeRequest(this.session.create(r,e),n)},submit:function(e,n){var r=t.service.URI.CART_SUBMIT;return this.makeRequest(this.session.create(r,e),n)}})}),define("service/CategoryService",["service/BaseService","Config"],function(e,t){return e.extend({uri:t.service.URI.CATEGORIES})}),define("service/ProductService",["service/BaseService","Config"],function(e,t){return e.extend({uri:t.service.URI.PRODUCTS,listProductsByCategory:function(e,n,r){var i=this.replaceTemplate(t.service.URI.PRODUCTS_BY_CATEGORY,{categoryId:e});return this.makeRequest(this.session.retrieve(i,n),r)},search:function(e,n){var r=t.service.URI.PRODUCTS_SEARCH;return this.makeRequest(this.session.retrieve(r,e),n)},getProductsByIds:function(e,t){return this.makeRequest(this.session.retrieve(this.uri,e),t)},getOffersForProduct:function(e,n,r,i,s){var o=this.replaceTemplate(t.service.URI.OFFERS_FOR_PRODUCT,{productId:e,popName:n});return this.makeRequest(this.session.retrieve(o,r),i,s)}})}),define("service/OfferService",["service/BaseService","Config"],function(e,t){return e.extend({uri:t.service.URI.OFFERS,list:function(e,t,n,r){var i=this.replaceTemplate(this.uri,{popName:e});return this.makeRequest(this.session.retrieve(i,t),n,r)},get:function(e,t,n,r){var i=this.replaceTemplate(this.uri,{popName:e})+"/"+t;return this.makeRequest(this.session.retrieve(i,n),r)}})}),define("service/ProductOfferService",["service/BaseService","Config"],function(e,t){return e.extend({uri:t.service.URI.PRODUCT_OFFERS,list:function(e,t,n,r,i){var s=this.replaceTemplate(this.uri,{popName:e,offerId:t});return this.makeRequest(this.session.retrieve(s,n),r,i)},get:function(e,t,n,r,i){var s=this.replaceTemplate(this.uri,{popName:e,offerId:t})+"/"+n;return this.makeRequest(this.session.retrieve(s,r),i)}})}),define("service/OrderService",["service/BaseService","Config"],function(e,t){return e.extend({uri:t.service.URI.ORDERS})}),define("Client",["Config","q","Util","connection/Session","service/CartService","service/CategoryService","service/ProductService","service/OfferService","service/ProductOfferService","service/ShopperService","service/OrderService","AsyncRequester"],function(e,t,n,r,i,s,o,u,a,f,l,c){window.console||(window.console={}),window.console.log||(window.console.log=function(){});var h=c.extend({init:function(t,c){this.options={env:"prod",authElementId:"",authRedirectUrl:e.config.DEFAULT_REDIRECT_URI,authMode:e.authMode.IFRAME},this.options=n.merge(this.options,c),this.setEnvironment(this.options.env),this.session=new r(t,this.createAuthConfig(t,this.options)),this.cart=new i(this),this.categories=new s(this),this.products=new o(this),this.offers=new u(this),this.productOffers=new a(this),this.shopper=new f(this),this.orders=new l(this),this._super(this.session)},setEnvironment:function(t){t=="dev"?e.connection.URI.BASE_URL=e.connection.URI.DEV_BASE_URL:e.connection.URI.BASE_URL=e.connection.URI.PRD_BASE_URL},createAuthConfig:function(e,t){return{elementId:t.authElementId,authRedirectUrl:t.authRedirectUrl,strategy:t.authMode,client_id:e}},connect:function(e){return this.makeRequest(this.session.anonymousLogin(),e)},forceRefreshToken:function(e){return this.makeRequest(this.session.forceRefreshToken(),e)},forceResetSession:function(e){return this.makeRequest(this.session.forceResetSession(),e)},login:function(e,t){return this.makeRequest(this.session.authenticate(e),t)},logout:function(e){return this.makeRequest(this.session.logout(),e)},disconnect:function(e){return this.makeRequest(this.session.disconnect(),e)},checkConnection:function(e){var n=t.defer();return this.cart.get({fields:"id"},function(t){e()}),n.promise},getSessionInfo:function(){return{clientId:this.session.apikey,connected:this.session.connected,authenticated:this.session.authenticated,token:this.session.token,refreshToken:this.session.refreshToken,tokenExpirationTime:this.session.tokenExpirationTime}},setSessionInfo:function(e){this.session.setSessionInfo(e)}});return h}),define("drapi",["service/ShopperService","auth/AuthManager","Config","Client","Util"],function(e,t,n,r,i){var s={};return s.api={},s.api.callbacks={editAccount:e.editCallback,auth:t.authCallback},window.dr=s,{callbacks:{editAccount:e.editCallback,auth:t.authCallback},Client:r,authModes:n.authMode,util:i}})